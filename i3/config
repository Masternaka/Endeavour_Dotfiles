#!/usr/bin/env i3

################################################################################
#                                                                              #
#                           CONFIGURATION i3WM                                #
#                                                                              #
################################################################################

# KEY DEFINITIONS TO REMEMBER
# $mod = Set below
# Mod4 = Super key
# Mod1 = ALT key
# Control = CTRL key
# Shift = SHIFT key
# Escape = ESCAPE key
# Return = ENTER or RETURN key
# KP_Enter = Keypad Enter
# Pause = PAUSE key
# Print = PRINT key
# Tab = TAB key

# ==============================================================================
# 1. VARIABLES ET DÉFINITIONS
# ==============================================================================

# Définition de la touche mod (touche Windows/Super)
set $mod Mod4

# Définition des moniteurs
set $firstMonitor HDMI-2
set $secondMonitor DP-1

# Variables de couleurs (à ajouter selon vos préférences)
# set $bg-color           #2f343f
# set $inactive-bg-color  #2f343f
# set $text-color         #f3f4f5
# set $inactive-text-color #676E7D
# set $urgent-bg-color    #E53935

# ==============================================================================
# 2. APPARENCE ET INTERFACE
# ==============================================================================

# Police pour les titres des fenêtres
font pango: Noto Sans Regular 10

# Bordures et gaps
new_window pixel 1
gaps inner 6
gaps outer 3

# Border control
hide_edge_borders both
bindsym $mod+shift+b exec --no-startup-id i3-msg border toggle

# changing border style
bindsym $mod+t border normal
bindsym $mod+y border pixel 1
bindsym $mod+u border none

# new_window pixel 1
new_window normal
# new_window none

# new_float pixel 1
new_float normal
# new_float none

# Layout par défaut
workspace_layout default
default_orientation horizontal

# ==============================================================================
# 3. CONFIGURATION DES MONITEURS
# Sur endeavouros il y a un script pour configurer les écrans #
# ==============================================================================

# Configuration xrandr pour les écrans
exec --no-startup-id xrandr --output HDMI-1 --off --output HDMI-2 --primary --mode 1920x1080 --pos 0x0 --rotate normal --output DP-1 --mode 1920x1080 --pos 1920x0 --rotate normal --output HDMI-3 --off

# start a script to setup displays
# uncomment the next line, use arandr to setup displays and save the file as monitor:
# exec --no-startup-id ~/.screenlayout/monitor.sh

# ==============================================================================
# 4. GESTION DES WORKSPACES
# ==============================================================================

# Attribution des workspaces aux moniteurs
workspace 1 output $firstMonitor
workspace 2 output $firstMonitor
workspace 3 output $firstMonitor
workspace 4 output $firstMonitor
workspace 5 output $firstMonitor
workspace 6 output $secondMonitor
workspace 7 output $secondMonitor
workspace 8 output $secondMonitor
workspace 9 output $secondMonitor
workspace 10 output $secondMonitor

# Attribution des noms aux workspaces
set $ws1 "1"
set $ws2 "2"
set $ws3 "3"
set $ws4 "4"
set $ws5 "5"
set $ws6 "6"
set $ws7 "7"
set $ws8 "8"
set $ws9 "9"
set $ws10 "10"

# Accès direct aux workspaces
bindsym $mod+1 workspace 1
bindsym $mod+2 workspace 2
bindsym $mod+3 workspace 3
bindsym $mod+4 workspace 4
bindsym $mod+5 workspace 5
bindsym $mod+6 workspace 6
bindsym $mod+7 workspace 7
bindsym $mod+8 workspace 8
bindsym $mod+9 workspace 9
bindsym $mod+0 workspace 10

# Déplacer les fenêtres vers les workspaces
bindsym $mod+Shift+1 move container to workspace 1; workspace 1
bindsym $mod+Shift+2 move container to workspace 2; workspace 2
bindsym $mod+Shift+3 move container to workspace 3; workspace 3
bindsym $mod+Shift+4 move container to workspace 4; workspace 4
bindsym $mod+Shift+5 move container to workspace 5; workspace 5
bindsym $mod+Shift+6 move container to workspace 6; workspace 6
bindsym $mod+Shift+7 move container to workspace 7; workspace 7
bindsym $mod+Shift+8 move container to workspace 8; workspace 8
bindsym $mod+Shift+9 move container to workspace 9; workspace 9
bindsym $mod+Shift+0 move container to workspace 10; workspace 10

# Navigation entre workspaces
bindsym $mod+Tab workspace next
bindsym $mod+Shift+Tab workspace prev
bindsym Mod1+Ctrl+Right workspace next
bindsym Mod1+Ctrl+Left workspace prev

# Nouveau workspace vide
bindsym $mod+Shift+n exec --no-startup-id ~/.config/i3/scripts/empty_workspace

# Focus automatique sur fenêtre urgente
for_window [urgent=latest] focus

# ==============================================================================
# 5. GESTION DES FENÊTRES
# ==============================================================================

# Modificateur pour déplacer les fenêtres flottantes
floating_modifier $mod

# Navigation entre fenêtres
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right

# Déplacer les fenêtres
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right

# Redimensionnement des fenêtres
bindsym $mod+Mod1+Ctrl+Right resize shrink width 1 px or 1 ppt
bindsym $mod+Mod1+Ctrl+Up resize grow height 1 px or 1 ppt
bindsym $mod+Mod1+Ctrl+Down resize shrink height 1 px or 1 ppt
bindsym $mod+Mod1+Ctrl+Left resize grow width 1 px or 1 ppt

# Orientation et layout
bindsym $mod+h split h
bindsym $mod+v split v
bindsym $mod+f fullscreen toggle
bindsym $mod+s layout stacking
bindsym $mod+g layout tabbed
bindsym $mod+e layout toggle split

# Basculer entre tiling et flottant
bindsym $mod+Shift+space floating toggle
bindsym $mod+space focus mode_toggle

# Focus sur le conteneur parent
bindsym $mod+a focus parent

# ==============================================================================
# 6. APPLICATIONS ET RACCOURCIS SYSTÈME
# ==============================================================================

# Lancer un terminal
bindsym $mod+Return exec --no-startup-id kitty

# Fermer une fenêtre
bindsym $mod+q kill

# Menu de sortie/arrêt
bindsym $mod+Shift+e exec --no-startup-id ~/.config/i3/scripts/powermenu

# Power Profiles menu switcher (rofi)
bindsym $mod+Shift+p exec --no-startup-id ~/.config/i3/scripts/power-profiles

# Verrouillage d'écran
# verrouiller en brouillant l'écran:
bindsym $mod+l exec --no-startup-id ~/.config/i3/scripts/blur-lock

# Verrouillage automatique après mise en veille
exec --no-startup-id xss-lock -l ~/.config/i3/scripts/blur-lock

# Aide des raccourcis
bindsym F1 exec --no-startup-id ~/.config/i3/scripts/keyhint-2

# ==============================================================================
# 7. GESTION i3WM
# ==============================================================================

# Recharger la configuration
bindsym $mod+Shift+c reload

# Redémarrer i3
bindsym $mod+Shift+r restart

# ==============================================================================
# 8. CONTRÔLES MULTIMÉDIA ET MATÉRIEL
# ==============================================================================

# Contrôle du volume
bindsym XF86AudioRaiseVolume exec --no-startup-id ~/.config/i3/scripts/volume_brightness.sh volume_up
bindsym XF86AudioLowerVolume exec --no-startup-id ~/.config/i3/scripts/volume_brightness.sh volume_down
bindsym XF86AudioMute exec --no-startup-id ~/.config/i3/scripts/volume_brightness.sh volume_mute
bindsym XF86AudioMicMute exec amixer sset Capture toggle

# Contrôle volume graduel
bindsym $mod+XF86AudioRaiseVolume exec --no-startup-id amixer -D pulse sset Master 1%+ && pkill -RTMIN+1 i3blocks
bindsym $mod+XF86AudioLowerVolume exec --no-startup-id amixer -D pulse sset Master 1%- && pkill -RTMIN+1 i3blocks

# Contrôle de la luminosité
bindsym XF86MonBrightnessUp exec --no-startup-id ~/.config/i3/scripts/volume_brightness.sh brightness_up
bindsym XF86MonBrightnessDown exec --no-startup-id ~/.config/i3/scripts/volume_brightness.sh brightness_down

# Contrôle audio/lecture
bindsym XF86AudioPlay exec --no-startup-id playerctl play-pause
bindsym XF86AudioNext exec --no-startup-id playerctl next
bindsym XF86AudioPrev exec --no-startup-id playerctl previous

# basculer entre les dispositifs audio pour la sortie
bindsym $mod+p exec --no-startup-id ~/.config/i3/scripts/audio-device-switch

# ==============================================================================
# 9. DÉMARRAGE AUTOMATIQUE
# ==============================================================================

# Démarre le composant de rendu graphique pour les fenêtres picom
exec_always --no-startup-id picom --config  ~/.config/picom.conf

# Démarre le composant de gestion des autorisations pour polkit-gnome
exec --no-startup-id /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1

# Démarre le programme qui genere les fichiers DesktopEntry
# dex execute .desktop files + apps using /etc/xdg/autostart.
# when second to i3 a DE is installed or mixed usage of i3 + xfce4 or GNOME
# in this cases better disable dex and use manual starting apps using xdg/autostart
# if enabled you should comment welcome app.
# https://github.com/jceb/dex
#exec --no-startup-id dex -a -s /etc/xdg/autostart/:~/.config/autostart/
exec --no-startup-id dex --autostart --environment i3

# Active le pavé numérique au démarrage
exec --no-startup-id numlockx on

# Definit le fond d'écran
exec --no-startup-id sleep 2 && nitrogen --restore
# exec --no-startup-id sleep 1 && feh --bg-fill /usr/share/endeavouros/backgrounds/endeavouros-wallpaper.png

# Demarre Polybar
exec_always --no-startup-id ~/.config/polybar/launch.sh &

# définir les économies d'énergie pour l'affichage:
exec --no-startup-id xset s 480 dpms 600 600 600

# désactiver l'économie d'énergie (par exemple en cas d'utilisation de xscreensaver)
#exec --no-startup-id xset -dpms

# Demarre conky:
#exec_always --no-startup-id conky

# Demarre le gestionnaire de notifications
exec --no-startup-id /usr/bin/dunst

# Activation du autotiling
exec_always --no-startup-id autotiling

# ==============================================================================
# 10. RÈGLES POUR APPLICATIONS SPÉCIFIQUES
# ==============================================================================

# définir le paramètre (nontiling) pour les applications qui en ont besoin
for_window [class="Yad" instance="yad"] floating enable
for_window [class="Galculator" instance="galculator"] floating enable
for_window [class="Blueberry.py" instance="blueberry.py"] floating enable
for_window [title="Copying"] floating enable
for_window [title="Deleting"] floating enable
for_window [title="Moving"] floating enable
for_window [window_role="pop-up"] floating enable
for_window [window_role="^Preferences$"] floating enabledéfinir le paramètre pour les applications qui en ont besoin
for_window [window_role="setup"] floating enable

# définir le paramètre (nontiling) pour les applications special
for_window [class="Xsane" instance="xsane"] floating enable
for_window [class="Pavucontrol" instance="pavucontrol"] floating enable
for_window [class="qt5ct" instance="qt5ct"] floating enable
for_window [class="Blueberry.py" instance="blueberry.py"] floating enable
for_window [class="Bluetooth-sendto" instance="bluetooth-sendto"] floating enable
for_window [class="Gnome-disks"] floating enable
for_window [class="Nitrogen"] floating disable
for_window [class="Openrgb"] floating enable
for_window [window_role="About"] floating enable

# Donner le focus aux applications
for_window [class="Gnome-terminal"] focus
for_window [class="Kitty"] focus
for_window [class="Alacritty"] focus

# Definir la bordure pour les applications floating window
for_window [class="urxvt"] border pixel 1

# Definir la position des applications floating window
for_window [class=".*"] move position center

# bind program to workspace and focus to them on startup:
assign [class="Xfce4-terminal"] $ws1
assign [class="(?i)firefox"] $ws2
assign [class="Thunar"] $ws3
assign [class="thunderbird"] $ws4
assign [class="TelegramDesktop"] $ws5

# automatic set focus new window if it opens on another workspace than the current:
for_window [class=Xfce4-terminal] focus
for_window [class=(?i)firefox] focus
for_window [class=Thunar] focus
for_window [class=Thunderbird] focus
for_window [class=TelegramDesktop] focus

# Popups during fullscreen mode
popup_during_fullscreen smart

# ==============================================================================
# 11. RACCOURCIS CLAVIER POUR APPLICATIONS SPÉCIFIQUES
# ==============================================================================

bindsym $mod+w exec --no-startup-id /usr/bin/firefox
bindsym $mod+n exec --no-startup-id /usr/bin/thunar
bindsym Print exec --no-startup-id scrot ~/%Y-%m-%d-%T-screenshot.png && notify-send "Screenshot saved to ~/$(date +"%Y-%m-%d-%T")-screenshot.png"

# ==============================================================================
# 12. DEFINITIONS DES COULEURS POUR LA BARRE D'ÉTAT ET LES FENÊTRES
# ==============================================================================

# Define colors variables:
set $darkbluetrans  #08052be6
set $darkblue       #08052b
set $lightblue      #5294e2
set $urgentred      #e53935
set $white          #ffffff
set $black          #000000
set $purple         #e345ff
set $darkgrey       #383c4a
set $grey           #b0b5bd
set $mediumgrey     #8b8b8b
set $yellowbrown    #e1b700

# define colors for windows:
#class                      border      bground     text        indicator   child_border
client.focused              $lightblue  $darkblue   $white      $mediumgrey $mediumgrey
client.unfocused            $darkblue   $darkblue   $grey       $darkgrey   $darkgrey
client.focused_inactive     $darkblue   $darkblue   $grey       $black      $black
client.urgent               $urgentred  $urgentred  $white      $yellowbrown    $yellowbrown

# ==============================================================================
# 13. BARRE D'ÉTAT
# ==============================================================================

# Start i3bar to display a workspace bar
# (plus the system information i3status finds out, if available)
bar {
        font pango: Noto Sans Regular 10
        status_command i3blocks -c ~/.config/i3/i3blocks.conf
            position top
#           i3bar_command i3bar --transparency
# it could be that you have no primary display set: set one (xrandr --output <output> --primary)
# reference: https://i3wm.org/docs/userguide.html#_tray_output
            #tray_output primary
            tray_padding 0

# When strip_workspace_numbers is set to yes,
# any workspace that has a name of the form
# “[n][:][NAME]” will display only the name.
strip_workspace_numbers yes
##strip_workspace_name no

            colors {
            separator          $purple
            background         $darkgrey
            statusline         $white
#                           border              bg          txt         indicator
        focused_workspace   $mediumgrey         $grey       $darkgrey   $purple
        active_workspace    $lightblue          $mediumgrey $darkgrey   $purple
        inactive_workspace  $darkgrey           $darkgrey   $grey       $purple
        urgent_workspace    $urgentred          $urgentred  $white      $purple
    }
}

# you can add different bars for multidisplay setups on each display:
# set output HDMI-0 to the display you want the bar, --transparency can be set.
# Transparency needs rgba color codes to be used where the last two letters are the transparency factor see here:
# https://gist.github.com/lopspower/03fb1cc0ac9f32ef38f4
# #08052be6 --> e6=90%

# bar {
#   font pango: Noto Sans Regular 10
#   status_command i3blocks -c ~/.config/i3/i3blocks-2.conf
#   i3bar_command i3bar --transparency
#   output HDMI-0
#   position bottom
#
# When strip_workspace_numbers is set to yes,
# any workspace that has a name of the form
# “[n][:][NAME]” will display only the name.
#strip_workspace_numbers yes
##strip_workspace_name no
#
#   colors {
#       separator          $purple
#       background         $darkbluetrans
#           statusline         $white
#                           border          bg              txt         indicator
#       focused_workspace   $lighterblue    $lighterblue    $darkblue   $purple
#       active_workspace    $lightdblue     $lightdblue     $darkblue   $purple
#       inactive_workspace  $darkblue       $darkblue       $lightdblue $purple
#       urgent_workspace    $urgentred      $urgentred      $white      $purple
#   }
#}

# # ==============================================================================
# 14. MENU D'APPLICATIONS ROFI
# ==============================================================================

## rofi bindings fancy application menu ($mod+d /F9 optional disabled)
bindsym $mod+d exec --no-startup-id rofi -modi drun -show drun \
        -config ~/.config/rofi/rofidmenu.rasi

## rofi bindings for window menu ($mod+t /F10 optional disabled)
bindsym $mod+t exec --no-startup-id rofi -show window \
        -config ~/.config/rofi/rofidmenu.rasi
